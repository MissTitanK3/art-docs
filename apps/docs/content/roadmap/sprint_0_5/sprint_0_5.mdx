# Sprint 0.5: Foundation Ready & Config Alignment

**Date:** 2026-01-21  
**Status:** ðŸŸ¢ **PHASE A COMPLETE** | **ALL BLOCKERS RESOLVED**  
**Blockers Resolved:** 6 of 6  COMPLETE

---

## Executive Summary

All six critical blockers are now **fully resolved and documented**:

-  **Backend API Contracts** ([Backend API Contracts](/specs/backend-api-contracts))
-  **Database Schema** ([Database Schema](/specs/database-schema))
-  **Authentication Architecture** ([Auth Architecture](/specs/authentication-architecture)): JWT + HttpOnly cookies, 3 core roles, multi-region isolation
-  **Offline Support** ([Offline Architecture](/specs/offline-support-architecture)): Local queuing, exponential backoff, last-write-wins
-  **Region Scope** ([Region Architecture](/specs/region-scope-architecture)): Multi-region MVP with 3 initial US regions
-  **Crisis/Management Modes** ([Mode Strategy](/specs/crisis-management-mode-strategy)): Two-mode UX separation, crisis default

**Action:** Sprint 0.5 kickoff is **FULL GO**. All teams can begin implementation immediately. Backend can start database setup, frontend can build components against auth and offline specs.

---

## Sprint Intent
- **Phase A (Kickoff):** Begin all blocker-dependent work immediately (B1-B6: API, Schema, Auth, Offline, Regions, Modes: Backend/Frontend foundation)
- **Phase B (Config):** Establish runtime configuration pattern for domains, APIs, and DB proxies across environments
- **Phase C (Alignment):** Wire the `web` app to the Region Dispatch System constitution references so language and invariants are discoverable from the app context

## Objective & Success Definition
**Objective:** Create a maintainable, environment-aware configuration foundation that enables all downstream sprints to reference shared invariants and constitution documents without duplication or drift. Simultaneously, unblock backend/frontend teams to begin foundation work from finalized API and schema specs.

**Success is achieved when:**
- Configuration changes propagate correctly across local/staging/production without code changes
- Future sprint teams can discover and reference constitution/language guidelines directly from the app
- Environment-specific domains and APIs are guaranteed to be correct in each deployment
- Backend API tables created and endpoints operational
- Frontend mock server and initial components built and tested

---

## For Backend Team

### Sprint 0.5 Kickoff Tasks

#### Phase A: Database Setup âœ…

1. **âœ… Create users table** â€” COMPLETE
   - Reference: [Schema: users table](/specs/database-schema#table-users)
   - Migration: `CREATE TABLE users (id, email, password_hash, role, allowed_regions, ...)`
   - Test: INSERT, SELECT, UPDATE, soft-delete
   - **Implementation:** [000001.sql](/packages/migrations/migrations/committed/000001.sql)

2. **âœ… Create dispatches table** â€” COMPLETE
   - Reference: [Schema: dispatches table](/specs/database-schema#table-dispatches)
   - Migration: `CREATE TABLE dispatches (id, region_id, location_lat, location_lon, ...)`
   - Test: INSERT with idempotent `client_id`, SELECT by region
   - **Implementation:** [000001.sql](/packages/migrations/migrations/committed/000001.sql)

#### Phase B: API Implementation âœ…

3. **âœ… Implement POST /auth/login** â€” COMPLETE
   - Reference: [API: POST /auth/login](/specs/backend-api-contracts#post-authlogin)
   - Query: Select from users table by email
   - Test: Valid credentials â†’ 200 with JWT, invalid â†’ 401
   - **Implementation:** [auth.ts](/packages/api-core/src/auth.ts)

4. **âœ… Implement POST /dispatches** â€” COMPLETE
   - Reference: [API: POST /dispatches](/specs/backend-api-contracts#post-dispatches)
   - Query: Insert into dispatches with client_id idempotency
   - Test: Valid payload â†’ 201, duplicate client_id â†’ 200 (idempotent), invalid location â†’ 422
   - **Implementation:** [dispatches.ts](/packages/api-core/src/dispatches.ts)

5. **âœ… Implement GET /dispatches** â€” COMPLETE
   - Reference: [API: GET /dispatches](/specs/backend-api-contracts#get-dispatches)
   - Query: Select from dispatches with cursor pagination, region filter, status filter
   - Test: Pagination works, filtering works, PII redaction for unauthenticated
   - **Implementation:** [dispatches.ts](/packages/api-core/src/dispatches.ts)

### Critical Decisions

- **B3 (Auth):** JWT + HttpOnly cookies, 3 core roles (responder, admin, viewer), multi-region user isolation - [See Auth Spec](/specs/authentication-architecture)
- **B4 (Offline):** MVP includes offline submission with exponential backoff and idempotent deduplication - [See Offline Spec](/specs/offline-support-architecture)
- **B5 (Regions):** Multi-region MVP with 3 initial US regions (Portland OR, Denver CO, Boston MA) - [See Region Spec](/specs/region-scope-architecture)
- **B6 (Modes):** Both Crisis Mode (default) and Management Mode (admin-only) in MVP with URL separation - [See Mode Spec](/specs/crisis-management-mode-strategy)

### Database Indexes (Add after kickoff)

```sql
ALTER TABLE dispatches ADD INDEX idx_region_status (region_id, status);
ALTER TABLE dispatches ADD INDEX idx_region_created (region_id, created_at DESC);
-- Others listed in [Database Schema](/specs/database-schema#indexing-strategy)
```

---

## For Frontend Team

### Sprint 0.5 Kickoff Tasks

#### Phase A: Mock API Setup âœ…

1. **âœ… Create mock server from B1 spec** â€” COMPLETE
   - Reference: [Backend API Contracts](/specs/backend-api-contracts)
   - Endpoints to mock: POST /auth/login, POST /dispatches, GET /dispatches, GET /dispatches/:id
   - Storage: In-memory array (no real database needed)
   - Tool: MSW (Mock Service Worker) âœ…
   - **Implementation:** [Mock handlers](/apps/web/lib/mocks/)

2. **âœ… Implement auth flow** â€” COMPLETE
   - Reference: [API: Auth section](/specs/backend-api-contracts#authentication--session-management)
   - Mock response: Store JWT in cookie, return user object
   - Test: Login form works, JWT persists
   - **Implementation:** [auth-handlers.ts](/apps/web/lib/mocks/auth-handlers.ts)

#### Phase B: Component Development âœ…

3. **âœ… Build dispatch form** â€” COMPLETE
   - Reference: [API: POST /dispatches request body](/specs/backend-api-contracts#post-dispatches)
   - Fields: location (lat/lon), description, urgency
   - Validation: Required fields, coordinate ranges
   - Test: Form submits to mock endpoint
   - **Implementation:** [DispatchForm.tsx](/apps/web/components/DispatchForm.tsx)

4. **âœ… Build dispatch list** â€” COMPLETE
   - Reference: [API: GET /dispatches response](/specs/backend-api-contracts#get-dispatches)
   - Display: Active dispatches with pagination
   - Filtering: By status (open/acknowledged/escalated)
   - Test: Cursor pagination works, filters apply
   - **Implementation:** [DispatchList.tsx](/apps/web/components/DispatchList.tsx)

5. **âœ… Build dispatch detail** â€” COMPLETE
   - Reference: [API: GET /dispatches/:dispatch_id response](/specs/backend-api-contracts#get-dispatchesdispatch_id)
   - Display: Full dispatch details, responder list
   - **Implementation:** [DispatchDetailView.tsx](/apps/web/components/DispatchDetailView.tsx)

### Integration Points (Ready When Backend Deploys)

- [ ] Replace mock server with real API endpoints
- [ ] Test real JWT flow
- [ ] Verify pagination cursor works
- [ ] Verify error handling (400, 401, 403, 422)

---

## For QA/Testing Team

### Sprint 0.5 Test Plan

#### API Contract Verification (From B1)

```
âœ“ POST /auth/login
  âœ“ Valid credentials â†’ 200 with token
  âœ“ Invalid credentials â†’ 401
  âœ“ Missing email â†’ 400

âœ“ POST /dispatches
  âœ“ Valid payload â†’ 201 with dispatch_id
  âœ“ Invalid location â†’ 422
  âœ“ Duplicate client_id â†’ 200 (idempotent)
  âœ“ Missing location â†’ 400

âœ“ GET /dispatches
  âœ“ Returns list with cursor pagination
  âœ“ Filters by status and urgency
  âœ“ Cursor-based pagination works across multiple requests
  âœ“ Unauthenticated user sees PII-redacted data

âœ“ GET /dispatches/:id
  âœ“ Returns dispatch detail
  âœ“ Invalid dispatch_id â†’ 404
  âœ“ Unauthorized user â†’ 403
```

#### Database Verification (From B2)

```
âœ“ users table
  âœ“ Insert user, select by email
  âœ“ password_hash never exposed
  âœ“ allowed_regions restricts access

âœ“ dispatches table
  âœ“ Insert with client_id, verify UNIQUE constraint
  âœ“ Insert duplicate client_id, verify no duplicate
  âœ“ Select with region filter
  âœ“ Verify version field increments on UPDATE
  âœ“ Verify is_deleted flag works (soft delete)

âœ“ audit_log table
  âœ“ Audit entry created for dispatch creation
  âœ“ Audit entry includes before_state, after_state
  âœ“ Audit entries are immutable (append-only)
```

---

## Configuration & Constitution Alignment

### Constitution & Language Resources

For all future sprint work, reference these foundational documents:

- **[System Constitution](/index)** - Core principles, development intent, and accessibility requirements
- **[Invariant Checklist](/compliance/invariant-checklist)** - System-wide invariants that must hold across all features
- **[Language Guidelines](/language/reassurance)** - Approved copy patterns for reassurance and error messaging
- **[Prompt Guidance](/prompt-guidance)** - Development standards and constitution-aligned practices

**Integration Pattern:** All feature work should start by reviewing relevant constitution sections to ensure alignment with system intent. Copy should follow language guidelines. New features should validate against invariants.

### Framing the Unknowns
- **Backend readiness:** Will backend services be available with documented API contracts before intake work begins?  **YES** - B1 & B2 finalized
- **Regional variations:** How much will region-specific configuration differ beyond domains/APIs?
- **Environment naming:** Will Vercel project settings align with environment names (local/staging/production)?
- **Constitution maintenance:** Who will own updates to constitution docs, and how will changes propagate to deployed apps?

## Primary Risks & Tradeoffs
**Risks:**
- Misconfigured env vars in CI/Vercel could silently point to wrong backend, causing data/logic errors
- If constitution docs are not linked from the app, future teams may not discover or use them
