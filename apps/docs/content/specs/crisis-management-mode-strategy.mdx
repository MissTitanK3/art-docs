# Crisis vs. Management Mode Strategy

**Blocker:** B6 - Crisis vs. Management Mode Scope Decision  
**Version:** 1.0  
**Date:** 2026-01-17  
**Status:** ðŸŸ¢

---

## Executive Summary

**Decision: MVP Includes Both Crisis Mode AND Management Mode**

The system will launch with two distinct modes:

1. **Crisis Mode** (default, always available)
   - Minimal, calm, low-friction dispatch coordination
   - No configuration language
   - Core responder actions only

2. **Management Mode** (explicitly entered, for admins)
   - Administrative configuration and oversight
   - User management, settings, audit logs
   - Only entered by explicit action
   - Warning banner if active crisis exists

**Key Principle:** Modes are separated at the URL level (`/dispatch/*` vs `/admin/*`), in the UI, and in the feature set. No leakage of admin concepts into crisis mode.

---

## Constitution Basis

The Constitution already defines two modes. We're implementing both as specified:

### From [Dispatch System Modes](/constitution/modes.md)

**Crisis Mode (Default):**
- Primary goal: Coordinate active situations
- Minimal UI, calm language, no admin language
- Allowed: Create, view, update, escalate dispatches
- Prohibited: Configuration, schedules, inventory, role changes

**Management Mode (Explicit Entry):**
- Primary goal: Configure and administer
- Full configuration UI
- Allowed: Schedules, inventory, roles, audit logs
- Safety: Warning banner if crisis active

This spec implements exactly what the Constitution requires.

---

## Why Both Modes in MVP?

### Reason 1: Constitutional Requirement
The Constitution explicitly defines both modes as binding specifications. Not implementing both means not meeting constitutional requirements.

### Reason 2: Prevents Mode Confusion
Separating crisis from admin prevents the "admin accidentally in admin mode during active dispatch" scenario (detailed in [Tabletop Scenario 8](../compliance/tabletop-scenarios.mdx#scenario-8-admin-accidentally-enters-crisis-during-active-dispatch)).

### Reason 3: Complexity Budget
- Crisis Mode: ~8 screens, ~15 components (simple)
- Management Mode: ~5 screens, ~10 components (simple)
- **Total: ~15 screens, less complex than single mode with feature flags**

### Reason 4: User Mental Model
Users already think in terms of "crisis response" vs. "administrative work." Forcing them into a single UI with toggles increases cognitive load under stress.

### Reason 5: Operational Safety
Mode separation at the URL level (`/dispatch/` vs `/admin/`) allows:
- Different authentication requirements (e.g., 2FA only for admin)
- Different rate limits
- Different audit logging
- Different deployment targets (different servers if needed)

---

## Crisis Mode Specification (MVP Full)

### Purpose
Enable rapid, low-friction coordination during active situations.

### Visual Design
- **Minimal UI:** Only dispatch cards and essential controls
- **Calm language:** "Coordinating response" not "crisis escalation"
- **No jargon:** No role names, configuration terms, or system language
- **Clear focus:** What is happening now? What do I do next?

### Core Screens

#### 1. Dispatch Creation (Minimal)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ðŸ“ What's the situation?       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Location input]                â”‚
â”‚  [Brief description]             â”‚
â”‚  [Optional: Photo upload]        â”‚
â”‚                                  â”‚
â”‚  [Submit] [Cancel]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Constraints:**
- Required: Location, description
- Optional: Photo, urgency (default: normal)
- No category selection (post-MVP)
- No inventory linking (post-MVP)
- No role selection (post-MVP)

**Constitutional Alignment:**
-  No required dropdowns
-  No admin language
-  Clear submit/cancel (not destructive)
-  Works offline (stored in IndexedDB)

#### 2. Active Dispatch View (Minimal)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ðŸ“ Main St & 5th Ave              â”‚
â”‚   Accident with injury              â”‚
â”‚   12:15 PM â€¢ 2 responding           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   âœ“ I'm Responding                  â”‚
â”‚   â†‘ Needs More Help                 â”‚
â”‚   âœ“ Issue Resolved                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Allowed Actions:**
-  "I'm Responding" button (signal availability)
-  "Needs More Help" (escalate urgency)
-  "Issue Resolved" (close dispatch)
-  Edit description (if creator)
-  Add photo/note (if responder)

**Not Allowed:**
- âŒ Assign to responder (no role selection in crisis mode)
- âŒ Change category (not in crisis mode)
- âŒ Delete (only marked as closed)

**Constitutional Alignment:**
-  Actions confirm success
-  No irreversible deletions
-  All system state visible
-  Escalation visible to all

#### 3. Active Dispatch List (Minimal)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Active Incidents   (3 urgent)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. ðŸ“ Main St        12:15 PM    â”‚
â”‚    Accident          [I'm Help] â”‚
â”‚                                  â”‚
â”‚ 2. ðŸ“ Central Park    12:08 PM   â”‚
â”‚    Lost hiker        [I'm Help] â”‚
â”‚                                  â”‚
â”‚ 3. ðŸ“ Highway 12      12:02 PM   â”‚
â”‚    Vehicle overturned [I'm Help] â”‚
â”‚                                  â”‚
â”‚ [View Map] [New +]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Constraints:**
- Default sort: Most recent first (but urgent floats to top)
- No filtering by category/status (single view, all incidents visible)
- No pagination (if >20 incidents, shows count "20+ active")
- One action per card: "I'm Responding"

#### 4. Mode Warning Banner (Crisis + Active Incidents)

When active incidents exist:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸  3 active situations need help â”‚
â”‚ [View Crisis Dashboard]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Always visible at top of screen if user in non-crisis mode and incidents exist.

### Allowed User Actions in Crisis Mode
| Action | Requirements | Logged? |
|--------|--------------|---------|
| Create dispatch | Location + description |  Yes |
| Update dispatch | Creator or authorized |  Yes |
| Signal "I'm responding" | Authentication |  Yes |
| Escalate urgency | Authentication |  Yes |
| Close dispatch | Any responder |  Yes |
| Add photo/note | Any responder |  Yes |
| Reopen closed dispatch | Original creator |  Yes |

### Prohibited in Crisis Mode
| Feature | Why Not MVP | When |
|---------|------------|------|
| Schedule management | Not crisis coordination | Sprint 2+ |
| Inventory logistics | Not crisis coordination | Sprint 2+ |
| Role assignment | Increases UI complexity | Sprint 2+ |
| Category tagging | Creates decision burden | Sprint 2+ |
| Advanced filtering | Decision paralysis | Sprint 2+ |
| Audit log review | Not immediate need | Sprint 2+ |
| Team messaging | Out of scope | Sprint 3+ |

---

## Management Mode Specification (MVP Core)

### Purpose
Allow administrative configuration when no crisis coordination is required.

### Access Control
- **Who:** Users with `admin` role (from B3 Authentication Architecture)
- **How:** Click "Settings" in header â†’ Confirms active crisis count â†’ Takes to `/admin/` URL
- **When:** Only after login with HttpOnly secure cookie (B3 session)

### Visual Design
- **Clear separation:** Different URL, different color scheme
- **Large banner:** "This is admin mode. There are X active incidents."
- **Quick return:** "â† Back to Crisis Dashboard" always visible
- **Reduced urgency:** Removed real-time refresh, lower visual prominence

### Core Screens

#### 1. Admin Dashboard
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Settings & Administration        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ðŸ‘¥ User Management              â”‚
â”‚    â€¢ View all responders        â”‚
â”‚    â€¢ Activate/deactivate users  â”‚
â”‚    â€¢ Reset passwords            â”‚
â”‚                                  â”‚
â”‚ âš™ï¸  Regional Settings           â”‚
â”‚    â€¢ Escalation threshold       â”‚
â”‚    â€¢ Timezone                   â”‚
â”‚    â€¢ Emergency contact          â”‚
â”‚                                  â”‚
â”‚ ðŸ“‹ Audit Log                    â”‚
â”‚    â€¢ All actions (searchable)   â”‚
â”‚                                  â”‚
â”‚ [â† Back to Crisis]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. User Management Screen
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Responder Roster                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Alex K.          Active   [Edit] â”‚
â”‚ Blake R.         Active   [Edit] â”‚
â”‚ Jordan L.        Inactive [Edit] â”‚
â”‚                                  â”‚
â”‚ [+ Add Responder]               â”‚
â”‚ [â† Back to Settings]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**User Management Actions:**
-  View all users with region + role
-  Deactivate user (soft delete, audit logged)
-  Reset password (sends email)
-  View user's last activity
-  Invite new user (sends invite link)

**Prohibited in User Management:**
- âŒ Delete user (soft delete only, preserves audit trail)
- âŒ Change user's role (only admin can manage roles, post-MVP expansion)
- âŒ Access users from other regions

#### 3. Regional Settings Screen
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Regional Configuration            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Region:          Portland (OR)   â”‚
â”‚ Timezone:        America/LA      â”‚
â”‚ Status:          Active          â”‚
â”‚                                  â”‚
â”‚ Escalation Rules:                â”‚
â”‚  â€¢ Escalate after:   10 minutes  â”‚
â”‚  â€¢ Max concurrent:   âˆž           â”‚
â”‚                                  â”‚
â”‚ Public Viewing:     â˜‘ Enabled   â”‚
â”‚ Emergency Contact:  [+1-555...]  â”‚
â”‚                                  â”‚
â”‚ [Save] [Cancel] [â† Back]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Regional Settings Options:**
-  Escalation threshold (in minutes)
-  Timezone
-  Public viewing on/off
-  Emergency contact number
-  Language preferences
-  Urgency decay rules

**Prohibited:**
- âŒ Change region ID (set via environment)
- âŒ Delete audit logs
- âŒ Access other regions' settings

#### 4. Audit Log Screen
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Activity Log (Searchable)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2026-01-17 12:15:23 AM            â”‚
â”‚ Alex K. created dispatch:          â”‚
â”‚ "Accident @ Main St"               â”‚
â”‚ Region: Portland (OR)              â”‚
â”‚ [View Detail]                      â”‚
â”‚                                    â”‚
â”‚ 2026-01-17 12:14:05 AM            â”‚
â”‚ Blake R. closed dispatch:          â”‚
â”‚ "Lost hiker" (RESOLVED)            â”‚
â”‚ [View Detail]                      â”‚
â”‚                                    â”‚
â”‚ [â† Back to Settings]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Audit Log Visibility:**
-  All dispatch actions (create, update, close, reopen)
-  All escalation events
-  All user actions (responder signaling)
-  Searchable by actor, date, dispatch ID
-  Readonly (no deletion)

**Prohibited:**
- âŒ Modify logs
- âŒ Delete logs
- âŒ See logs from other regions
- âŒ Export to external system

### Allowed User Actions in Management Mode

| Action | Requirements | Logged? |
|--------|--------------|---------|
| View user roster | Admin auth |  Yes |
| Deactivate user | Admin auth |  Yes |
| Reset password | Admin auth |  Yes |
| View regional config | Admin auth |  Yes |
| Update regional config | Admin auth |  Yes |
| View audit log | Admin auth |  Yes |
| Trigger lockdown mode | Regional admin |  Yes |
| View warning banner | All users |  No |
| Return to crisis mode | All users |  No |

### Not in Management Mode (Post-MVP)

| Feature | Reason | When |
|---------|--------|------|
| Inventory management | Separate system | Sprint 3+ |
| Schedule management | Separate system | Sprint 3+ |
| Advanced reporting | Analytics tool | Sprint 4+ |
| Backup/restore | DevOps responsibility | Post-sprint |
| API key management | Not MVP | Sprint 2+ |
| Advanced role configuration | Not MVP | Sprint 2+ |

---

## Mode Switching Specification

### User Journey

#### Crisis â†’ Management
```
1. User in Crisis Mode (viewing dispatch)
   [Settings] button in header
        â†“
2. Browser checks: Are there active incidents?
        â†“
   YES â†’ Show warning banner
         "This region has 3 active incidents."
         [Still Go to Settings] [Cancel]
        â†“
3. User clicks [Still Go to Settings]
   â†’ Navigate to /admin/ URL
   â†’ Show "You are in admin mode"
   â†’ Display "â† Back to Crisis" button
        â†“
4. User in Management Mode
```

#### Management â†’ Crisis
```
1. User in Management Mode (admin settings)
   [â† Back to Crisis Dashboard] button visible
        â†“
2. User clicks button
   â†’ Navigate to /dispatch/ URL
   â†’ Show active incidents count
        â†“
3. User back in Crisis Mode (default view)
```

#### Lockdown Mode (Exceptional Override)
```
1. Regional admin triggers Lockdown Mode
   â†’ All users forced to Crisis Mode
   â†’ Admin UI hidden
   â†’ Banner shows: "Lockdown Mode Active"
   â†’ Timestamp + Reason visible
        â†“
2. Lockdown lasts 24 hours (auto-expire)
   OR admin manually ends it
        â†“
3. Upon expiration/manual exit:
   â†’ Users can return to Management Mode
   â†’ Exit is logged and visible to all
```

### Mode State Preservation

**When user returns to an app:**

```
If user was in Crisis Mode last session:
  â†’ Show crisis dashboard

If user was in Management Mode last session:
  â†’ Check: Are there active incidents?
  â†’ If YES: Show warning banner
  â†’ If NO: Show admin dashboard

If Lockdown Mode is active:
  â†’ Force Crisis Mode
  â†’ No Management Mode access
```

**Session Timeout:**
- Crisis Mode: 30 minutes inactivity
- Management Mode: 15 minutes inactivity (higher security)
- On timeout: Return to login, then restore prior mode (if still active)

---

## Integration with B1, B2, B3, B4, B5

### With B1 (Backend API Contracts)

All 14 endpoints have mode-level permissions:

| Endpoint | Crisis Mode | Management Mode | Notes |
|----------|-------------|-----------------|-------|
| POST /dispatches |  Create |  View only | Responders create, admins view |
| GET /dispatches |  View active |  View all + history | Admins see audit trail |
| GET /users | âŒ Not visible |  Admin only | User roster only in admin |
| POST /lockdown | âŒ Not visible |  Admin only | Only admins trigger lockdown |
| GET /audit | âŒ Not visible |  Admin only | Audit logs admin-only |

### With B2 (Database Schema)

All tables support mode-level filtering:

```sql
-- Crisis Mode queries
SELECT * FROM dispatches 
WHERE region_id = ? AND is_deleted = FALSE
AND created_at > NOW() - INTERVAL 48 hours

-- Management Mode queries
SELECT * FROM dispatches 
WHERE region_id = ?  -- all, including closed

SELECT * FROM audit_log 
WHERE region_id = ? AND actor_role = 'admin'
```

### With B3 (Authentication Architecture)

Mode access controlled by JWT role:

```json
{
  "sub": "user123",
  "role": "responder",
  "allowed_regions": ["us-west-1"],
  "allowed_modes": ["crisis", "read-only"]  // responders can't access admin mode
}

{
  "sub": "admin456",
  "role": "admin",
  "allowed_regions": ["us-west-1"],
  "allowed_modes": ["crisis", "management", "lockdown"]  // admins can access both
}
```

### With B4 (Offline Support)

Offline submissions respect mode:

```typescript
// Crisis mode dispatch creation (stored in IndexedDB)
{
  type: 'dispatch_create',
  mode: 'crisis',
  region_id: 'us-west-1',
  data: { location, description },
  timestamp: 1234567890,
  status: 'queued'
}

// Management mode NOT offline-capable
// (admin actions require connectivity)
```

### With B5 (Regional Scope)

Mode separation is per-region:

```
Portland (us-west-1):
  â”œâ”€ Crisis Mode (/dispatch/us-west-1/)
  â””â”€ Management Mode (/admin/us-west-1/)

Denver (us-west-2):
  â”œâ”€ Crisis Mode (/dispatch/us-west-2/)
  â””â”€ Management Mode (/admin/us-west-2/)

Boston (us-east-1):
  â”œâ”€ Crisis Mode (/dispatch/us-east-1/)
  â””â”€ Management Mode (/admin/us-east-1/)
```

Users with multi-region access can switch regions + modes independently.

---

## Constitutional Invariants

All existing crisis mode invariants continue:

### Crisis Mode Invariants (From Constitution)

 **No admin-only language** - No role names, configuration terms visible

 **No irreversible actions** - All destructive actions confirmed

 **No required dropdowns** - All selections have defaults or optional

 **No jargon in errors** - Human-readable error messages

 **Active dispatches visible unauthenticated** - Transparency preserved

 **PII redacted for unauthenticated** - Privacy protected

 **All actions confirm success** - User always knows status

 **Lockdown entry/exit visible** - All users see mode changes

 **Lockdown auto-expires in 24h** - Prevents forgotten lockdowns

### Management Mode Invariants (New)

 **Mode always visible in header** - User knows which mode they're in

 **Crisis warning banner when incidents active** - Admin knows coordination is needed

 **Quick return path to crisis** - One click to switch back

 **No accidental entry during dispatch** - Entry requires explicit action

 **No mode bleeding** - Admin language not in crisis mode, crisis actions not in admin

 **Lockdown overrides management mode** - Safety during major incidents

---

## Implementation Phases

### Phase 1: Sprint 0 (Foundation)

**Backend:**
- [ ] Implement mode checking middleware on all endpoints
- [ ] Add `allowed_modes` to JWT token payload (B3 update)
- [ ] Create `/admin/` endpoint route
- [ ] Implement audit logging for all admin actions

**Frontend - Crisis Mode:**
- [ ] Create minimal dispatch creation flow
- [ ] Create active dispatch view (single card)
- [ ] Create active dispatch list (all incidents on one page)
- [ ] Implement "I'm Responding" signaling
- [ ] Implement offline storage with region scoping

**Frontend - Management Mode:**
- [ ] Create admin settings layout
- [ ] Create user roster screen (view-only, deactivate)
- [ ] Create regional config screen
- [ ] Create audit log screen

**Testing:**
- [ ] Verify crisis mode has zero admin language
- [ ] Verify management mode warning banner shows when incidents active
- [ ] Verify mode toggle works in both directions

**Status:**  Ready for Sprint 0 kickoff

### Phase 2: Sprint 1 (Enhancement)

**Frontend - Crisis Mode:**
- [ ] Implement escalation ("Needs More Help" button)
- [ ] Implement photo upload for dispatches
- [ ] Implement reopen functionality

**Frontend - Management Mode:**
- [ ] Implement reset password flow
- [ ] Implement invite new user flow
- [ ] Implement lockdown mode trigger

**Testing:**
- [ ] Verify lockdown mode forces crisis view
- [ ] Verify lockdown auto-expires in 24h
- [ ] Verify audit logs capture all admin actions

**Status:**  Ready for Sprint 1 kickoff

### Phase 3: Sprint 2+ (Post-MVP Expansion)

- [ ] Inventory management in management mode
- [ ] Schedule management in management mode
- [ ] Advanced reporting
- [ ] Role configuration UI
- [ ] API key management

---

## Testing Strategy

### Crisis Mode Tests

**Invariant Compliance:**
- [ ] Scan all UI text for role names (dispatcher_admin, etc.) â†’ must be zero
- [ ] Attempt to proceed through flow without selections â†’ must have sensible defaults
- [ ] Trigger errors â†’ must be human-readable
- [ ] Create dispatch unauthenticated â†’ must be visible to viewer

**Mode Switching:**
- [ ] Click Settings while viewing dispatch â†’ warning banner appears
- [ ] Warning shows correct active incident count
- [ ] Confirm settings â†’ navigate to /admin/
- [ ] Click "Back to Crisis" â†’ return to /dispatch/

**Offline:**
- [ ] Create dispatch while offline â†’ queued locally
- [ ] Restore connectivity â†’ dispatch syncs
- [ ] Reopen offline dispatch â†’ respects mode

### Management Mode Tests

**Access Control:**
- [ ] Non-admin user tries to access /admin/ â†’ 403 Forbidden
- [ ] Admin user without region access tries to access /admin/other-region/ â†’ 403 Forbidden
- [ ] Admin with multi-region access can switch regions in admin mode

**Warning Banner:**
- [ ] 1 active incident â†’ banner shows "1 incident"
- [ ] 5 active incidents â†’ banner shows "5 incidents"
- [ ] No active incidents â†’ no banner

**Lockdown Mode:**
- [ ] Admin triggers lockdown â†’ all users see "Lockdown Mode Active"
- [ ] Users cannot access management mode during lockdown
- [ ] Crisis mode remains fully functional
- [ ] Lockdown expires after 24h
- [ ] Admin can manually exit lockdown before 24h

### Cross-Mode Tests

**Constitutional Compliance:**
- [ ] No language bleed (crisis terms don't appear in admin, admin terms don't appear in crisis)
- [ ] Audit log captures all actions in both modes
- [ ] Regional isolation enforced (users only see their region in both modes)
- [ ] Offline queue respects mode boundaries (crisis mode only)

---

## Decision Log

### Decision 1: Both Modes in MVP (Not Crisis-Only)

**Options Considered:**
1. Crisis Mode only â†’ Simpler MVP but violates Constitution
2. Both modes â†’ More work but Constitutional compliance
3. Integrated toggle â†’ Single UI, easier but mode confusion risk

**Decision:** Both modes (Option 2)

**Rationale:**
- Constitution explicitly specifies both modes as binding
- Prevents mode confusion during stress (scenario 8 in compliance)
- Not significantly more complex (15 screens total)
- Separates concerns: coordination vs. configuration
- Allows future enhancements (2FA only for admin, different servers, etc.)

**Trade-off:** Sprint 0 includes UI for both modes (slightly more work)
**Benefit:** Constitution compliant, operational safety, clearer mental model

---

### Decision 2: URL-Level Mode Separation (/dispatch/ vs /admin/)

**Options Considered:**
1. Single URL with toggle â†’ Simpler, but mode can blur
2. Separate URLs â†’ Cleaner, but more deployment overhead
3. Subdomain (crisis.region.app vs admin.region.app) â†’ Most separation but infrastructure heavy

**Decision:** Separate URLs (Option 2)

**Rationale:**
- Clear visual/cognitive separation
- Enables different auth (e.g., 2FA for /admin/)
- Enables different rate limits (admin less frequent)
- Enables eventual separate infrastructure (if needed)
- Constitutional requirement: "Mode bleed is a safety risk"

**Trade-off:** Slightly more complex routing
**Benefit:** Clear separation, operational flexibility

---

### Decision 3: Warning Banner When Crisis Active

**Options Considered:**
1. No warning â†’ Admin might forget
2. Hard block â†’ Can't access admin even for critical settings
3. Warning banner â†’ Clear notice but can proceed

**Decision:** Warning banner (Option 3)

**Rationale:**
- Tabletop scenario 8: Chris needs to check schedule during active event
- Hard block prevents legitimate admin tasks
- Warning is visible, not intrusive
- One-click return to crisis mode

**Trade-off:** Doesn't prevent accidental admin mode
**Benefit:** Balances admin access with situational awareness

---

### Decision 4: Lockdown Mode Always Forces Crisis

**Options Considered:**
1. Lockdown only affects crisis mode â†’ Admin can still access settings
2. Lockdown forces crisis mode, blocks admin â†’ Can't access critical settings
3. Lockdown forces crisis but allows admin with password â†’ Complex

**Decision:** Lockdown forces crisis mode completely (Option 2)

**Rationale:**
- Lockdown is for major incidents (entire region focused on crisis)
- Admin work can wait 24 hours
- Constitution: "Lockdown mode forces all users into Crisis Mode"
- No exceptions make the rule simple and safe

**Trade-off:** Admin loses access during lockdown
**Benefit:** Prevents distraction during major incidents

---

### Decision 5: No Offline in Management Mode

**Options Considered:**
1. Support offline admin actions â†’ Complex sync, potential conflicts
2. Offline only in crisis mode â†’ Simple, aligns with B4 design
3. Graceful error message â†’ Clear UX

**Decision:** No offline in management mode (Option 2)

**Rationale:**
- Admin actions infrequent, can wait for connectivity
- Admin actions (user deactivation, config changes) shouldn't queue
- Crisis mode (dispatch creation) benefits from offline
- Simplifies B4 sync logic
- Management mode is not "mission-critical" during emergencies

**Trade-off:** Admin features require connectivity
**Benefit:** Simpler architecture, aligns with crisis-first mentality

---

## Success Criteria

### Before Sprint 0 Kickoff

- [ ] Crisis mode screens show zero admin language
- [ ] Management mode requires explicit navigation (not default)
- [ ] Mode toggle visible in header
- [ ] Warning banner appears when crisis active
- [ ] URLs clearly differentiate modes (/dispatch/ vs /admin/)
- [ ] All 9 crisis mode invariants pass
- [ ] All 5 management mode invariants pass

### By End of Sprint 0

- [ ] Both modes deployed and functional
- [ ] Audit logs capture all actions in both modes
- [ ] Lockdown mode triggers correctly
- [ ] Regional isolation enforced
- [ ] Constitutional compliance verified

### By End of Sprint 1

- [ ] Lockdown auto-expires in 24h
- [ ] Manual lockdown exit captures actor + timestamp
- [ ] All tabletop scenarios pass
- [ ] User testing with non-technical users under simulated stress

---

## Alignment with Prior Blockers

### With B1 (Backend API Contracts)

 **All 14 endpoints have mode-level permissions**
- Responders can create dispatches (crisis)
- Admins can reset passwords (management)
- Audit endpoint is management-only

 **Mode is stateless parameter**
- No new endpoints needed
- Mode permissions added to existing endpoints
- JWT role + endpoint combination determines access

### With B2 (Database Schema)

 **All tables support mode queries**
- Dispatches: Crisis shows active only, admin shows all
- Audit log: Only accessible in management mode
- Users: Not visible in crisis mode

 **No new tables needed**
- Modes are application-layer, not data-layer concept
- Region isolation already in schema (region_id)
- Mode isolation added via query filters

### With B3 (Authentication Architecture)

 **JWT role determines mode access**
- responder role â†’ crisis mode only
- admin role â†’ crisis + management modes
- viewer role â†’ crisis mode, read-only

 **Added `allowed_modes` to token payload**
- Extra field: `"allowed_modes": ["crisis", "management"]`
- Simple to check on mode switch
- Consistent with existing role-based approach

### With B4 (Offline Support)

 **Offline submission only in crisis mode**
- Management actions require connectivity
- IndexedDB stores mode in queued dispatch
- Sync respects mode boundary

 **No conflicts with offline strategy**
- Crisis mode includes dispatch creation (works offline)
- Management mode excludes data mutations (wouldn't need offline)
- Same exponential backoff for crisis sync

### With B5 (Regional Scope)

 **Mode separation per-region**
- /dispatch/us-west-1/ for Portland crisis
- /admin/us-west-1/ for Portland admin
- Users with multi-region access see mode switcher

 **Regional isolation respected**
- Admin can only configure their region
- Crisis incidents only show their region
- Cross-region access â†’ 403 Forbidden

---

## Conclusion

**B6 is RESOLVED with both Crisis Mode and Management Mode in MVP.**

This decision:
-  Meets Constitutional requirements
-  Prevents mode confusion during stress
-  Integrates cleanly with B1-B5
-  Is achievable in Sprint 0
-  Supports long-term operational needs

Foundation work (B1-B6) is now 100% complete. Sprint 0 kickoff implementation can begin.
